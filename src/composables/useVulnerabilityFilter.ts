/**
 * Composable: useVulnerabilityFilter
 *
 * This composable centralizes the filtering logic for scan results:
 * - Maintains the current filter state ('all' | 'vulnerable')
 * - Computes a filtered list of results for display
 * - Computes the total number of vulnerable packages
 *
 * Keeping this logic here keeps ResultsSection.vue focused on rendering.
 */

import { ref, computed, type Ref } from 'vue'
import type { PackageVulnerabilityResult } from '../services/osvClient'

export function useVulnerabilityFilter(
  results: Ref<PackageVulnerabilityResult[]>
) {
  // Current filter mode controlled by the radio buttons
  const filter = ref<'all' | 'vulnerable'>('all')

  /**
   * filteredResults
   *
   * Returns:
   * - All results when filter = 'all'
   * - Only vulnerable packages when filter = 'vulnerable'
   *
   * Automatically updates when either the results or filter change.
   */
  const filteredResults = computed(() => {
    if (filter.value === 'vulnerable') {
      return results.value.filter(r => r.vulnerabilities.length > 0)
    }
    return results.value
  })

  /**
   * totalVulnerable
   *
   * Counts how many packages have at least one vulnerability.
   */
  const totalVulnerable = computed(
    () => results.value.filter(r => r.vulnerabilities.length > 0).length
  )

  return {
    filter,
    filteredResults,
    totalVulnerable
  }
}
